<script>
let lastTime = 0;

function now(){
  return new Date().toLocaleTimeString();
}

function addMsg(text, cls){
  const div = document.createElement("div");
  div.className = "msg " + cls;
  div.innerHTML = text + `<div class="time">${now()}</div>`;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function send(){
  const v = input.value.trim();
  if(!v) return;

  const t = Date.now();
  if(t - lastTime < 1000){
    addMsg("âš ï¸ Slow downâ€¦","bot");
    return;
  }
  lastTime = t;

  addMsg(v,"user");
  input.value = "";
  toggleSend();

  setTimeout(()=>{
    addMsg("ðŸ¤– Demo AI reply: " + v,"bot");
  },600);
}

function toggleSend(){
  sendBtn.style.display = input.value ? "flex" : "none";
}

function voice(){
  if(!('webkitSpeechRecognition' in window)){
    alert("Voice not supported");
    return;
  }
  const r = new webkitSpeechRecognition();
  r.lang = "en-IN";
  r.onresult = e => {
    input.value = e.results[0][0].transcript;
    toggleSend();
  };
  r.start();
}

function toggleMenu(){
  menu.style.display = (menu.style.display === "block") ? "none" : "block";
}

function openCamera(){
  cam.click();
  menu.style.display = "none";
}

function openGallery(){
  gal.click();
  menu.style.display = "none";
}

function showImage(inp){
  const f = inp.files[0];
  if(!f) return;
  const img = URL.createObjectURL(f);
  addMsg(`<img src="${img}" style="max-width:100%;border-radius:12px">`,"user");
}

document.querySelectorAll(".time").forEach(t => t.innerText = now());
</script>